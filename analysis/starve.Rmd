---
title: "Phase 1: Starvation Resistance Analysis"
output:
  workflowr::wflow_html:
    toc: false
    latex_engine: "xelatex"
editor_options:
  chunk_output_type: console
---


```{r setup, include=FALSE}
library(dplyr)
starve <- tibble(read.csv("data/starve.csv")) %>% select(-X)
x <- starve$f
y <- starve$m

```
## Setup
The analysis begins with the data files prepared in [Phase 1](www.google.com). MAKE THIS LINK TO DATA PREP. The goal of these steps was to visually characterize the data and form the basis for groupings of DGRP lines for further analysis.


### Histograms of Starvation Resistance
```{r base-hist, echo=FALSE}

par(mfrow=c(1,2))

#Female
hist(x, 
     col="red",
     border="black",
     prob=TRUE,
     xlab = "Starvation Resistance",
     main = "Female Lines")

lines(density(x),
      lwd = 2,
      col = "black")

#Male
hist(y, 
     col="blue",
     border="black",
     prob=TRUE,
     xlab = "Starvation Resistance",
     main = "Male Lines")

lines(density(y),
      lwd = 2,
      col = "black")

```
First impressions on histograms are that both are unimodal with light skew to the right.




### Comparative Boxplot
```{r boxplot, echo = FALSE}
boxplot(x,
        y,
        col = c("red","blue"),
        names=c("Female", "Male"),
        main="Sex Comparison of Starvation Resistance",
        xlab="Starvation Resistance",
        ylab="Sex",
        horizontal = TRUE)

```
Plotting the distributions on the same axis gives a more accurate representation of distribution between sexes. The average female has a much greate starvation resistance of `r round(mean(x), digits=3)` compared to the average male `r round(mean(y), digits=3)`. Outliers to the right of both boxplots indicate right skew. 



### Scatter Plot
```{r fm-scatter, echo = FALSE}
plot(x,
     y,
     col="black",
     xlab="Female Starvation Resistance",
     ylab="Male Starvation Resistance",
     abline(reg=lm(y~x), 
            col="purple"))
text(x = 85, y = 25,
     "y = 14.2347x + 0.5192",
     cex = 0.75)
text(x = 85, y = 22.5,
     "R=0.4693, p-value < 2.2e-16",
     cex = 0.75)

#summary(lm(y~x))

```
The trendline is a Simple Linear Regression 'reg=lm(y~x)' with R and p values extracted from summary statistics. The slope indicates a positive correlation between male and female starvation resistance while the R value of 0.4693 indicates that the correlation is not close to linear.


### QQ Plots
```{r qqplot, echo = FALSE}
par(mfrow=c(1,2))

qqnorm(x, main="Female Distribution")
qqline(x)
qqnorm(y, main="Male Distribution")
qqline(y)


```

There is some systematic deviation from linearity on both tails in Females and on the upper tail in Males. Eyeballing is not an exhaustive measure of discerning normality. Quantitative methods are needed:

## Shapiro-Wilk Tests for Normality

The Shapiro-Wilk method was chosen as it retains the best power 


The test statistic formula is:
$$
W = \frac{(\sum_{i=1}^{n}a_ix_{(i)})^{2}}{\sum_{i=1}^{n}(x_i-\overline x)^{2}}
$$

More about the Shapiro-Wilk test statistic can be found [here](https://en.wikipedia.org/wiki/Shapiro%E2%80%93Wilk_test#Theory). 

$W$ values closer to 1 indicate normality, with $W = 1$ being perfectly normal.



```{r shapiro, echo = FALSE}

Female_Starvation <- x
Male_Starvation <- y

shapiro.test(Female_Starvation)
shapiro.test(Male_Starvation)
```



At an $\alpha$ level of 0.05, we have sufficient evidence to reject that the Female population is normally distributed as p < $\alpha$ (0.001826 < 0.05).

At an $\alpha$ level of 0.05, we do not have sufficient evidence to reject that the Male population is normally distributed as p > $\alpha$ (0.07023 > 0.05). Notably the correlation is not strong as the p-value is close to 0.05.



### Group selection


```{r dif-avg-hist, echo = FALSE}

par(mfrow=c(1,2))

#Difference
hist(starve$dif, 
     col="purple",
     border="black",
     xlab = "Change in Starvation Resistance",
     main = "Difference of Female and Male Lines")

#Average
hist(starve$avg, 
     col="pink",
     border="black",
     xlab = "Average Starvation Resistance",
     main = "Avg of Female and Male Lines")

```
The two groups of interest were extreme values on both ends.



### Scatter Plot
```{r dif-avg-scatter, echo = FALSE}
plot(starve$avg,
     starve$dif,
     col="black",
     xlab="Line Average",
     ylab="Intersex Difference",
     abline(reg=lm(starve$dif~starve$avg), 
            col="purple"))
text(x = 72, y = -12.5,
     "y = 0.3258 - 2.3984",
     cex = 0.75)
text(x = 72, y = -15,
     "R=0.1293, p-value < 1.37e-7",
     cex = 0.75)

#summary(lm(starve$dif~starve$avg))

```


Along with this, I wanted to look at the highest and lowest averages. Twenty lines from the top and bottom were partitioned for further analysis. With these four groups, I sought to look for difference in genotype and fold-change in gene expression [here](www)LINK to PHASE ??? not sure yet





```{r, echo = FALSE}
```




